"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_cheerio=require("cheerio"),_cheerio2=_interopRequireDefault(_cheerio),_bluebird=require("bluebird"),_bluebird2=_interopRequireDefault(_bluebird),_requestPromise=require("request-promise"),_requestPromise2=_interopRequireDefault(_requestPromise),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),DEFAULT_REGION="eu",DEFAULT_GAME_MODE="competitive",OverScrap=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getCategoryName",value:function(e,t){var r=function(){return _lodash2.default.get(e,"["+t+"].children[0].children[0].children[0].children")}();return r?function(){return _lodash2.default.get(r.filter(function(e){return"span"===e.name&&"stat-title"===e.attribs.class}),"[0].children[0].data")}():"Unknown"}},{key:"computeStatsByHero",value:function(e,t){var r=this,n=function(e){return _lodash2.default.get(t,"["+e+"].children[1].children",[])},a=function(e){return e.children[0].children[0].data},i=function(e){return e.children[1].children[0].data};return t.length&&e.name?{name:e.name,stats:t.reduce(function(e,u,o){return e[r.getCategoryName(t,o)]=n(o).reduce(function(e,t){return e[a(t)]=i(t),e},{}),e},{})}:null}},{key:"getHeroListForGameMode",value:function(e,t){var r=function(){return e("div#"+t+' section div div [data-js="career-select"][data-group-id="stats"]')[0].children};return new _bluebird2.default(function(e,t){try{e(r().map(function(e){return{id:e.attribs.value,name:e.attribs["option-id"]}}))}catch(e){t(new Error("No hero list found for specified game mode"))}})}},{key:"getHeroStatsForGameMode",value:function(e,t,r){var n=this,a=function(e){return t("div#"+r+' section div [data-group-id="stats"][data-category-id="'+e.id+'"] div div.card-stat-block table.data-table').toArray()};return _bluebird2.default.map(e,function(e){return n.computeStatsByHero(e,a(e))}).then(function(e){return e.reduce(function(e,t){return e[t.name]=t.stats,e},{})})}},{key:"loadDataFromProfile",value:function(e,t,r){var n=this,a=e.split("#");return a.length<2?_bluebird2.default.reject(new Error("Invalid tag")):_requestPromise2.default.get({uri:"https://playoverwatch.com/en-us/career/pc/"+(t||DEFAULT_REGION)+"/"+a[0]+"-"+a[1]}).then(function(e){var t=r||DEFAULT_GAME_MODE,a=_cheerio2.default.load(e);return n.getHeroListForGameMode(a,t).then(function(e){return n.getHeroStatsForGameMode(e,a,t)})})}}]),e}();module.exports=OverScrap;