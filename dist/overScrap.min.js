"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_cheerio=require("cheerio"),_cheerio2=_interopRequireDefault(_cheerio),_bluebird=require("bluebird"),_bluebird2=_interopRequireDefault(_bluebird),_requestPromise=require("request-promise"),_requestPromise2=_interopRequireDefault(_requestPromise),_lodash=require("lodash"),_lodash2=_interopRequireDefault(_lodash),OverScrap=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getCategoryName",value:function(e,r){var t=function(){return _lodash2.default.get(e,"["+r+"].children[0].children[0].children[0].children")}();return t?function(){return _lodash2.default.get(t.filter(function(e){return"span"===e.name&&"stat-title"===e.attribs.class}),"[0].children[0].data")}():"Unknown"}},{key:"computeStatsByHero",value:function(e,r){var t=this,n=function(e){return _lodash2.default.get(r,"["+e+"].children[1].children",[])},a=function(e){return e.children[0].children[0].data},i=function(e){return e.children[1].children[0].data};return r.length&&e.name?{name:e.name,stats:r.reduce(function(e,u,o){return e[t.getCategoryName(r,o)]=n(o).reduce(function(e,r){return e[a(r)]=i(r),e},{}),e},{})}:null}},{key:"getHeroListForGameMode",value:function(e,r){var t=function(){return e("div#"+r+' section div div [data-js="career-select"][data-group-id="stats"]')[0].children};return new _bluebird2.default(function(e,r){try{e(t().map(function(e){return{id:e.attribs.value,name:e.attribs["option-id"]}}))}catch(e){r(new Error("No hero list found for specified game mode"))}})}},{key:"getHeroStatsForGameMode",value:function(e,r,t){var n=this,a=function(e){return r("div#"+t+' section div [data-group-id="stats"][data-category-id="'+e.id+'"] div div.card-stat-block table.data-table').toArray()};return _bluebird2.default.map(e,function(e){return n.computeStatsByHero(e,a(e))}).then(function(e){return e.reduce(function(e,r){return e[r.name]=r.stats,e},{})})}},{key:"loadDataFromProfile",value:function(e,r,t){var n=this,a=e.split("#");return a.length<2?_bluebird2.default.reject(new Error("Invalid tag")):_requestPromise2.default.get({uri:"https://playoverwatch.com/en-us/career/pc/"+r+"/"+a[0]+"-"+a[1]}).then(function(e){var r=_cheerio2.default.load(e);return n.getHeroListForGameMode(r,t).then(function(e){return n.getHeroStatsForGameMode(e,r,t)})})}}]),e}();module.exports=OverScrap;